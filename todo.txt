~~~~~ GOAL ~~~~~

From js query wasm sqlite with the same api as websql. Make it persist.

~~~~~~~~~~~~~~~~

Doing:
x import the code to get the speed test working
x get build of including a c function and console logging working
x consult sql.js to understand how they do the includes, mimic the include of open and exec
x get wrapped version working in memory, no pthreadfs
x get that working in a web worker
- get that working with pthreadfs
  !! does not work.
  - debug the spot where this failes
  - make a simple file opening test case. Attempt to run this peristant inside a worker.
- translate speed test to js and write a test

Absorbing:
- virtual memory chapter
- filesystem chapter
- multithreading chapter


What I *think* I know:
- I think operations must run in a pthread
  - What is my understanding of the wasm runtime? How pthread work in wasm?


Questions:
- What would it look like if I just wanted to use the c api for querying in the command line?
  - this seems workable just from the text editor example and existing methods
- How is their code using the peristant filesystem?



can modify how sql js is modularized:
https://github.com/sql-js/sql.js/issues/438


Theory:
- with proxy to pthread, we are calling out to the main thread for some things.
- with my webworker we are calling out to the webworker for some things, but the web worker doesn't have the needed api due to permissions.


do a test with unix stat
  - in main thread in mem
  - in webworker in mem
  - in webworker pthread
  - in main pthread build
  - try running with proxy to pthread
  - try running with regular build



next:
- draft questions for the guy
- ways to get thread result without blocking


can't it all happen inside 1 big thread?

- make notes on what I've tried so far. Articulate assumptions
- understand the asyncify stuff, can this get around the blocking?
- test out 1 big thread that spawns at startup and then gets communicated to
- read multithreading chapter





Notes:

- It works when running on the main thread using proxy to pthread.
  - would the example run in a webworker?
- It does not work when trying to run sql.js in a webworker for persistant files.
- It does work for sql.js in web worker in mempory.


Why doesn't the webworker example work?
  - theory something in the pthreadfs library relies on calling out to the main thread (like mayby opfs only accessible in main thread not in a worker) and calls are being proxied to a worker and this stalls forever.
    - can I simulate this in my simple example?

so Ideally I want to run all of my work in a pthread. this is what proxy to pthread does.
BUT, some issues:

- getting results, how does the caller get its results?
- how to proxy all the methods?
